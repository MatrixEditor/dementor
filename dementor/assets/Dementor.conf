[Dementor]

# Workspace directory for storing logs, temporary files and the
# database. Uncomment to set the current directory as working dir.
Workspace = "."

# Extra directories that can contain procotol files
# ExtraModules = [ "/path/to/directory" ]

# Enabled poisoners: These services respond to specific network queries
# with spoofed responses to capture authentication attempts.
LLMNR = true
mDNS  = true
NBTNS = false

# Enabled rogue servers: These services mimic legitimate network services
# to capture authentication credentials or other sensitive data. These
# servers can be enabled with true, 1 or "On".
SMTP = true
SMB = false
NBTDS = false
FTP = false
KDC = false
LDAP = false
QUIC = false

# =============================================================================
# Globals
# =============================================================================
# All variables you can specify in other sections can be defined here as a
# fallback. This section has the least priority and will be used if the target
# section does not contain the configuration value.
[Globals]
# Describe a list of hosts to include in poisoning. This will be a whitelist
# approach. Format is as follows:
#   A Filter can take different forms. It may be just a string (e.g. "127.0.0.1"),
#   a string with glob-pattern syntax (e.g. "*._tcp.*") or a dictionary with
#   explicit filter expressions:
#       - Ex1: { Target = "name" } : same as string but with explicit definition
#       - Ex2: { File = "..." } : builds filters from the given source file
#       - Ex3 { Target = "...", foo=1, bar=2} : extra config values also possible
# AnswerTo = []

# Blacklist approach with same filter structure
# Ignore = []

# =============================================================================
# Database Configuration
# =============================================================================
[DB]
# Duplicate credential storage behavior: If false, credentials are stored
# only once per unique set.
DuplicateCreds = true

# =============================================================================
# mDNS
# =============================================================================
[mDNS]
# Default Time-To-Live (TTL) for poisoned responses (in seconds).
TTL = 120

# Maximum number of domain name labels to filter.
MaxLabels = 1

# List of DNS query types that will be responded to.
AllowedQueryTypes = [ "A", "AAAA", "ALL" ]

# AnswerTo = [
    # { Target = "", TTL = 120 },
    # { File = "/path/to/hosts" },
    # regex string
    # "re:.*foobar.*"
    # simple string
    # "127.0.0.1"
# ]

# =============================================================================
# LLMNR
# =============================================================================
[LLMNR]
# Name to return when responding to queries (can be used with kerberos relay)
# More information here:
#   Abusing multicast poisoning for pre-authenticated Kerberos relay over HTTP
#   https://www.synacktiv.com/publications/abusing-multicast-poisoning-for-pre-authenticated-kerberos-relay-over-http-with
# AnswerName = "other-srv"

# =============================================================================
# SMB (Server Message Block) Configuration
# =============================================================================
[SMB]
# SMB server identification details (used in spoofed responses)
ServerName = "SPOOFED"
ServerOS = "UNIX"
ServerDomain = "WORKGROUP"

# Enable SMB2 protocol support (recommended for compatibility).
SMB2Support = true

# server challenge is specified in NTLM section, but can be configured
# here or in each server individually.

# Response error code sent when access is denied. Accepts integer NT_STATUS values
# or string equivalents (e.g., "STATUS_ACCESS_DENIED").
#   - 3221225506 or "STATUS_ACCESS_DENIED"
#   - 5963778 or "STATUS_SMB_BAD_UID"
# For more error codes, see impacket.nt_errors
# Use case example:
#  Tricking Windows SMB clients into falling back to WebDav
#  - https://www.synacktiv.com/publications/taking-the-relaying-capabilities-of-multicast-poisoning-to-the-next-level-tricking
ErrorCode = "STATUS_SMB_BAD_UID"

# You can define multiple SMB server instances, each with different port and settings.
[[SMB.Server]]
Port = 139
# Uncomment to disable Extended Session Security for this instance
# ExtendedSessionSecurity = false

[[SMB.Server]]
Port = 445
# ExtendedSessionSecurity = false

# =============================================================================
# SMTP (Simple Mail Transfer Protocol)
# =============================================================================
[SMTP]
# List of supported authentication mechanisms for SMTP clients.
AuthMechanisms = [ "NTLM", "PLAIN", "LOGIN" ]

# Fully Qualified Domain Name (FQDN) used by the SMTP server.
# The first part of the FQDN is used as the hostname in responses.
FQDN = "DEMENTOR"

# SMTP server banner (identifier and version sent to clients).
Ident = "Dementor 1.0"

# Require authentication before allowing clients to send emails.
RequireAUTH = false

# Attempt to downgrade authentication from NTLM to weaker methods like LOGIN.
# Only effective if the client is configured to use plaintext credentials.
Downgrade = true

# Require TLS encryption before processing any SMTP commands.
RequireSTARTTLS = false

[[SMTP.Server]]
Port = 2525

# [[SMTP.Server]]
# Port = 465

# [[SMTP.Server]]
# Port = 587
# Enable SSL with custom certificate here
# TLS = true
# Cert = "/path/to/cert"
# Key = "/path/to/key"


# =============================================================================
# NTLM Configuration
# =============================================================================
[NTLM]
# Server challenge value used in NTLM authentication.
# Should be a fixed 8-byte string.
Challenge = "1337LEET"

# Enable Extended Session Security (ESS) for NTLM authentication.
# ESS results in NTLMv1/v2-SSP hashes instead of regular NTLMv1/v2 hashes.
ExtendedSessionSecurity = true

# =============================================================================
# FTP Server(s)
# =============================================================================
[[FTP.Server]]
Port = 21

# =============================================================================
# Kerberos KDC
# =============================================================================
[Kerberos]
# Port can't be changed, salt should not be set
# Salt = "1337LEET1337LEET"

# See Hashcat Issue #2783
# - Kerberos 5, etype 18, Pre-Auth (19900) with salt fails
#   You can use this setting but make sure no custom salt has been configured
EncType = "aes256_cts_hmac_sha1_96"

# default configuration
# ErrorCode = "KDC_ERR_C_PRINCIPAL_UNKNOWN"

# =============================================================================
# LDAP
# =============================================================================
[LDAP]

# A list of capabilities to support. You can also set this option in each server
# Capabilities = []

# A list of SASL mechanisms to return. Can be set in each server
# SASLMechanisms = []

# Global timeout configuration (can be changed in each server). Zero (0) indeicates
# no timeout (default), all other values are set in seconds. Note that no timeout
# will lead to problems when closing Dementor.
Timeout = 2

# Hostname + fully qualified domain name, whereby the domain name is optional
# Full example: "HOSTNAME.domain.local"
FQDN = "DEMENTOR"

# Global TLS option, will enable TLS on all TCP servers
TLS = false

# TLS key and certificate (for all TCP servers)
# Cert = "..."
# Key = "/path/to/key"

# The error code to return after successful authentication. It is recommended to return
# an actual error code rather that success(0). By default, "unwillingToPerform" will be
# returned.
# ErrorCode = "unwillingToPerform"

[[LDAP.Server]]
Connectionless = false
Port = 389

[[LDAP.Server]]
# means UDP
Port = 389
Connectionless = true

# =============================================================================
# QUIC
# =============================================================================
[QUIC]
Port = 443
Cert = "default.cert"
Key = "default.key"

# Control the target smb server to connect to.
# TargetSMBPort = 445
# TargetSMBHost =

# =============================================================================
# Logging
# =============================================================================
[Log]
# List of debug loggers to enable for troubleshooting.
DebugLoggers = [ "asyncio", "mail.log", "impacket.smbserver", "impacket", "quic" ]
